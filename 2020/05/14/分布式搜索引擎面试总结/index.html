<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 分布式搜索引擎面试总结 · pinkDonkey</title><meta name="description" content="I'm a little pink donkey that keeps going ..."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/jekyll.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="pinkDonkey" type="application/atom+xml">
</head><body><header class="row-flex-row limit-width vh-center"><a href="/" class="logo"><img src="/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">Home</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   Blog</a></li><li class="nav-list-item"><a href="https://github.com/pinkDonkey190610" target="_blank" class="nav-link">github</a></li><li class="nav-list-item"><a href="http://weibo.com/7447881909" target="_blank" class="nav-link">weibo</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/2020/05/14/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/" class="post-title-link">分布式搜索引擎面试总结</a></h2><div class="post-meta"><ul class="post-tag-list"><li class="post-tag-item"><a href="/tags/面试/" class="post-tag-link">面试</a></li></ul><div class="post-time">Thursday, May 14th 2020</div></div><div class="post-content"><p>Elasticsearch是一个基于Apache Lucene(TM)的开源搜索引擎，无论是在开源还是专有领域，Lucene可以被认为是迄今为止最先进、性能最好、功能最全的搜索引擎库。但是，Lucene只是一个库，想要发挥其强大的作用，需使用Java并将其集成到你的应用中。Lucene非常复杂，你需要深入的了解检索相关的知识来理解它是如何工作的。Elasticsearch也是使用Java编写并使用Lucene来建立索引并实现搜索功能，但是它的目的是通过简单连贯的RESTful API让全文搜索变得简单并隐藏Lucene的复杂性。不过，Elasticsearch不仅仅是Lucene和全文搜索引擎，它还提供：<br>1、分布式的实时文件存储，每个字段都被索引并可被搜索<br>2、实时分析的分布式搜索引擎<br>3、可以扩展到上百台服务器，处理PB级结构化或非结构化数据</p>
<a id="more"></a>

<h2 id="Elasticsearch的核心概念"><a href="#Elasticsearch的核心概念" class="headerlink" title="Elasticsearch的核心概念"></a>Elasticsearch的核心概念</h2><p>1、近实时（Nrt）：从写入数据到可以被检索到有一个小延迟（大概1秒）；基于es执行搜索和分析可以达到秒级（倒排索引）<br>2、集群（Cluster）：集群包含多个节点，每个节点属于哪个集群是通过一个配置来决定的。对于中小型应用，刚开始一个集群一个节点是正常的<br>3、节点（Node）：集群中的一个节点，节点也有一个名称（默认是随机分配的），节点名称很重要（在执行运维管理操作的时候使用），默认节点会去加入一个名称为Elasticsearch的集群，如果直接启动一个节点，那么它们会自动组成一个Elasticsearch集群，一个节点也是可以组成一个Elasticsearch集群<br>4、索引—数据库（Index）：索引包含一堆像是结构的文档数据，比如可以有一个客户索引、订单索引、商品分类索引。一个Index包含多个Document，一个Index就代表一类类似的或者相同的Document。比如建立一个Product Index（商品索引），里面可能就存放了所有的商品数据，所有商品的Document（6.x版本，es规定一个索引只能有一个Type；7.x版本默认使用_doc作为Type；官方在8.x版本会彻底移除Type）<br>5、类型—表（Type）：每个索引都可以有一个或多个Type，Type是Index中的一个逻辑数据分类，一个Type下的Document都有相同的Field。比如博客系统有一个索引，可以定义用户数据Type、博客数据Type、评论数据Type<br>6、文档—行（Document）：文档是es中最小数据单元，一个Document可以是一条客户数据、一条订单数据，通常用JSON数据结构表示，每个Index下的Type中，可以存储多个Document<br>7、字段—列（Field）：Field是es的最小单位。一个Document里有多个Field，每个Field就是一个数据字段<br>8、映射—约束（Mapping）：数据如何存放到索引对象上，需要有一个映射配置，包括：数据类型、是否存储、是否分词等(创建一个名为blog的Index，Type不需要单独创建，在创建Mapping时指定就可以。Mapping用来定义Document中每个字段的类型，即所使用的Analyze、是否索引等属性)</p>
<h2 id="Elasticsearch常见问题解决方案"><a href="#Elasticsearch常见问题解决方案" class="headerlink" title="Elasticsearch常见问题解决方案"></a>Elasticsearch常见问题解决方案</h2><h4 id="Elasticsearch的分布式架构原理是什么？"><a href="#Elasticsearch的分布式架构原理是什么？" class="headerlink" title="Elasticsearch的分布式架构原理是什么？"></a>Elasticsearch的分布式架构原理是什么？</h4><p>Elasticsearch设计的理念是分布式搜索引擎，底层是基于Lucene的。其核心思想是在多台机器上启动多个es进程实例，组成一个es集群。es中存储数据的基本单位时索引，比如你要在es中存储一些订单数据，你就应该在es中创建一个索引，order_index，所有的订单数据就都写道这个索引里面去，一个索引差不多就是相当于是MySQL里的一张表（Index—&gt;Type—&gt;Mapping—&gt;Document—&gt;Field），这个索引可以拆分成多个Shard，每个Shard存储部分数据。这个Shard的数据实际是有多个备份，每个Shard都有一个Primary Shard负责写入数据，还有一个或多个Replica Shard，Primary Shard写入数据后，会将数据同步到其它几个Replica Shard上去。通过这个Replica的方案，每个Shard的数据都有多个备份，如果某个机器宕机了，还有别的机器上存储着相同的数据副本，这就实现了高可用。es集群多个节点，会字段选举一个节点为Master节点,这个Master节点其实就是干一些管理的工作，比如维护索引元数据，负责切换Primary Shard和Replica Shard身份之类的。要是Master节点宕机了，会重新选举一个节点升为Master节点。如果非master节点宕机了，那么会由Master节点让那个宕机节点上的Primary Shard的身份转移到其它机器上的Replica Shard。接着你要是修复了那个宕机机器，重启之后，Master节点会控制将缺失的Replica Shard分配过去，同步后续修改的数据，让集群恢复正常，上述就是Elasticsearch作为一个分布式搜索引擎最基本的架构设计</p>
</div></article><div class="pagination"><span class="pagination-prev">PREV</span><a href="/2020/04/28/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/" class="pagination-next">NEXT</a></div><div class="comments"></div></div><aside class="sidebar"><h3>分类标签</h3><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a></li></ul><h3>最新文章</h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/05/14/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/">分布式搜索引擎面试总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/28/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/">“消息队列面试总结”</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><P>© 2020 <a href="/">pinkDonkey</P></div></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80781234-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?ee75cf111111aa99f8540efa2570970";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>